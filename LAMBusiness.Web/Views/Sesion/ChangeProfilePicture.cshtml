
@{
    ViewBag.Title = "Imagen de Perfil";
}

<link href="~/css/cropper.css" rel="stylesheet" />
<link href="~/css/main.css" rel="stylesheet" />

<div class="modal-content border-0 box-shadow">
    <div class="modal-header pb-0">
        <div>
            <h3 class="modal-title" id="exampleModalLabel">Imagen de perfil</h3>
            <ul class="breadcrumb bg-transparent p-0 small">
                <li class="breadcrumb-item">Sesion</li>
                <li class="breadcrumb-item active text-info">Imagen de perfil</li>
            </ul>
        </div>
        <a asp-action="Sesion" asp-controller="Menu" class="close"><span>&times;</span></a>
    </div>
    <div class="col-12 text-right" id="actions">
        <div class="docs-buttons">
            <div class="btn-group">
                <button type="button" class="btn btn-info" data-method="rotate" data-option="-45" title="Rotate Left">
                    <span class="docs-tooltip" data-toggle="tooltip" title="Girar a la izquierda">
                        <span class="fa fa-undo-alt"></span>
                    </span>
                </button>
                <button type="button" class="btn btn-info" data-method="rotate" data-option="45" title="Rotate Right">
                    <span class="docs-tooltip" data-toggle="tooltip" title="girar a la derecha">
                        <span class="fa fa-redo-alt"></span>
                    </span>
                </button>
            </div>
            <div class="btn-group">
                <button type="button" class="btn btn-info" data-method="scaleX" data-option="-1" title="Flip Horizontal">
                    <span class="docs-tooltip" data-toggle="tooltip" title="Espejo horizontal">
                        <span class="fa fa-arrows-alt-h"></span>
                    </span>
                </button>
                <button type="button" class="btn btn-info" data-method="scaleY" data-option="-1" title="Flip Vertical">
                    <span class="docs-tooltip" data-toggle="tooltip" title="Espejo vertical">
                        <span class="fa fa-arrows-alt-v"></span>
                    </span>
                </button>
            </div>
            <div class="btn-group">
                <button type="button" class="btn btn-warning" data-method="reset" title="Reset">
                    <span class="docs-tooltip" data-toggle="tooltip" title="Resetear">
                        <span class="fa fa-sync-alt"></span>
                    </span>
                </button>
                <label class="btn btn-base btn-upload" for="inputImage" title="Upload image file">
                    <input type="file" class="sr-only" id="inputImage" name="file" accept="image/*">
                    <span class="docs-tooltip" data-toggle="tooltip" title="Cambiar imagen">
                        <span class="fa fa-upload"></span>
                    </span>
                </label>
            </div>
            <div class="btn-group btn-group-crop">
                <button type="button" class="btn btn-success" data-method="getCroppedCanvas" data-option="{ &quot;maxWidth&quot;: 4096, &quot;maxHeight&quot;: 4096 }">
                    <span class="docs-tooltip" data-toggle="tooltip" title="Actualizar imagen">
                        <span class="fa fa-save"></span>
                    </span>
                </button>
            </div>
        </div>
        <div class="col-md-3 docs-toggles">
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="col-12">
                <div class="docs-demo">
                    <div class="img-container">
                        <img id="image" src="@Url.Action("GetProfilePicture", "Sesion", new { id = ViewBag.Id, tipo = "original" })" alt="Picture">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Show the cropped image in modal -->
<div class="modal fade docs-cropped" id="getCroppedCanvasModal" role="dialog" aria-hidden="true" aria-labelledby="getCroppedCanvasTitle" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="getCroppedCanvasTitle">Imagen de perfil</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                <a class="btn btn-info" id="download" href="javascript:void(0);" onclick="cambiarImagenPerfil(event);">Cambiar imagen</a>
                @*<a class="btn btn-info" id="download" href="javascript:void(0);" download="cropped.jpg">Cambiar imagen</a>*@
            </div>
        </div>
    </div>
</div><!-- /.modal -->

@section scripts{
    <script src="~/js/cropper.js"></script>
    <script src="~/js/main.js"></script>

    <script>
        function cambiarImagenPerfil(e) {
            e.preventDefault();
            addProcess("Actualizando imagen de perfil");
            var image = ($("canvas")[0]).toDataURL("image/png");
            $.ajax({
                url: '@Url.Action("ChangeProfilePicture", "Sesion")',
                method: 'POST',
                dataType: 'text',
                data: { img: image },
                success: function (result) {
                    var r = JSON.parse(result);
                    removeProcess(r.estatus);
                    if (r.Error) {
                        alert('Error al actualizar la imagen de perfil');
                    } else {
                        window.location.href = '@Url.Action("Sesion", "Menu")';
                    }
                },
                error: function (result) {
                    removeProcess(r.estatus);
                    alert(result);
                },
                cache: false
            });
        }
    </script>
}
